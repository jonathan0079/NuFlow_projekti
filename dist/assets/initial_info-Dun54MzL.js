import"./auth-CgT9UiaM.js";/* empty css                     */document.addEventListener("DOMContentLoaded",function(){console.log("Health metrics form handler loaded");const a=document.getElementById("infoForm");a?a.addEventListener("submit",g):console.error("Form not found!");async function g(n){n.preventDefault();try{const s=localStorage.getItem("user");if(!s){alert("Kirjaudu sisään jatkaaksesi");return}const e=JSON.parse(s);console.log("User data from storage:",e);let t=null;e.user_id?t=parseInt(e.user_id,10):e.id?t=parseInt(e.id,10):e.user&&e.user.id?t=parseInt(e.user.id,10):e.userId?t=parseInt(e.userId,10):e.user&&e.user.sub?t=parseInt(e.user.sub.replace(/[^0-9]/g,""),10):e.sub&&(t=parseInt(e.sub.replace(/[^0-9]/g,""),10)),(!t||isNaN(t))&&(console.warn("Numeric user ID not found from standard fields"),t=1,console.log("Using temporary user ID for testing:",t)),console.log("Final user ID to be sent:",t);const l=e.token;if(!l){console.error("Token not found in user data"),alert("Istunto vanhentunut. Kirjaudu sisään uudelleen.");return}const u=document.querySelector('textarea[name="drug_use"]').value.trim(),d=document.querySelector('textarea[name="diseases_medications"]').value.trim(),c=document.querySelector('textarea[name="sleep"]').value.trim(),m=document.querySelector('textarea[name="self_assessment"]').value.trim();if(!u||!d||!c||!m){alert("Täytä kaikki kentät");return}const r=document.getElementById("submit-button"),y=r.textContent;r.textContent="Tallennetaan...",r.disabled=!0;const f={user_id:t,drug_use:u,diseases_medications:d,sleep:c,self_assessment:m};console.log("Sending health data:",f);const o=await fetch("http://72.145.13.207:5000/api/metrics/insert",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(f)});if(console.log("Response status:",o.status),o.ok)localStorage.setItem("healthMetricsCompleted","true"),i("Tiedot tallennettu onnistuneesti!","success"),setTimeout(()=>{window.location.href="diary.html"},1500);else{const p=await o.text();throw console.error("Server error response:",p),new Error(`Palvelinvirhe: ${o.status} - ${p||"Tuntematon virhe"}`)}}catch(s){console.error("Error:",s),i(`Virhe: ${s.message}`,"error");const e=document.getElementById("submit-button");e&&(e.textContent="Jatka",e.disabled=!1)}}function i(n,s="info"){let e=document.getElementById("status-message");e||(e=document.createElement("div"),e.id="status-message",e.style.position="fixed",e.style.top="20px",e.style.right="20px",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.zIndex="1000",e.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",document.body.appendChild(e)),e.textContent=n,s==="error"?(e.style.backgroundColor="#f44336",e.style.color="white"):s==="success"?(e.style.backgroundColor="#4CAF50",e.style.color="white"):(e.style.backgroundColor="#2196F3",e.style.color="white"),e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3)}});
